############### Overview #################
iSCSI - storage area network protocol, it uses scsi commands to share local
storage over networks

icsi port is 3260/tcp

LUN - Logical unit number represents a single addressable ISCSI
disk that is exported from and iscsi target server

IQN or iSCSI qualified name is a uniqe name used to identify iscsi
target server

iSNS - iscsi storage name service is a protocol used by initiator
to discover shared LUNs

#example
iqn:2018-03.com.localnet:maillun

#Authentication is done by CHAP with username and password
#Bacstore types may be:
physical device
Partition
RAID device
LVM volume
FIle
RAMDisk

############# iSCSI packages needed ##############
yum install targetcli

#Service to be enabled and started is called target

#for initiator
yum install iscsi-initiator-utils
systemctl start iscsid
systemctl start iscsi

############ Iscsi backstores ############

#Create different backstores

#FileIO backstores
/backstores/fileio create name /path/to/file 200M
write_back=false

#write back is using the linux fs cache (not recommended)

#Block backstores
/backstores/block create name=NAME dev=/dev/sdb

#PCSCI backstores
/backstores/pscsi create name=NAME dev=/dev/sdb1

#RAMDisk backstores
/backstores/ramdisk create name=NAME size=1GB

################# Create iscsi target ###############
/iscsi create 

#example

/iscsi> create iqn.2018-07.com.localnet:filedisk1
Created target iqn.2018-07.com.localnet:filedisk1.
Created TPG 1.
Global pref auto_add_default_portal=true
Created default portal listening on all IPs (0.0.0.0), port 3260.

#to create a lun for the target

/scsi/iqn.2018-07.com.localnet:filedisk1/tpg1/luns create /backstores/fileio/file 

#to create ACL for the LUN

/scsi/iqn.2018-07.com.localnet:filedisk1/tpg1/acl create iqn.2018-07.com.localnet:client1

set auth userid=user1
set auth password=password123

########### create iscsi initiator ##########

# to create initiation iscsi config file must be present

vi /etc/iscsi/initiatorname.iscsi

#example
InitiatorName=iqn.2018-07.com.localnet:client1

for authentication
/etc/iscsi/iscsid.conf

node.session.auth.authmethod = CHAP
node.session.auth.username = viktor
node.session.auth.password = viktor123

#restart the services
#Discover the targets
iscsiadm --mode discovery --type sendtargets --portal 192.168.55.206

#Login to target
iscsiadm --mode node --targetname iqn.2018-07.com.localnet:filedisk1 --portal 192.168.55.206 --login
